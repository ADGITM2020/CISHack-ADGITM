{% extends 'base.html' %}

{% load static %}

{% block title %}{{ product.product_name }}{% endblock %}

{% block extra_header_links %}
    <link rel="stylesheet" href="{% static 'inventory/css/detail.css' %}">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
{% endblock %}

{% block body %}
    <div id="container">
        <div class="previous-button"><a href="{% url 'inventory:current' %}"><<</a></div>
        <div id="titleBar">
            <h1>{{ product.product_name }}</h1>
            <h2>{{ product.product_id }}</h2>
            <h3>Rate:- Rs. {{ product.product_price }}</h3>
        </div>
        <div id="content">
            <div class="data-table">
                <table>
                    <tr>
                        <th>Invoice No.</th>
                        <th>Sum Total</th>
                        <th>Invoice Date</th>
                        <th>Invoice Details</th>
                    </tr>
                    {% for order in Orders %}
                        <tr>
                            <td>{{ order.bill_no.invoice_no }}</td>
                            <td>{{ order.total }}</td>
                            <td>{{ order.bill_no.bill_date }}</td>
                            <td class="bill-link"><a href="{% url 'bill:info' order.bill_no.pk %}"><i
                                    class="fas fa-info-circle"></i> Click me</a></td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
            <div class="chart-container">
                <canvas id="salesData"></canvas>
                <canvas id="salesData1"></canvas>
            </div>
            <div class="clearFix"></div>
        </div>
    </div>
{% endblock %}

{% block external_script %}
    <script src="{% static 'js/jquery-3.3.1.js' %}"></script>
    <script src="{% static 'js/Chart.js' %}"></script>
    {#        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>#}
{% endblock %}

{% block javascript %}
    <script>
        let productId = "{{ product.product_id }}";
        $(function () {
            'use strict';
            var quantityList, invoice_no_list, total_price_list;
            var maxQuantityValue, quantityValueBuffer, min_value, max_value, maxPriceValue, minPriceValue,
                priceValueBuffer, minQuantityValue;
            // Start chart
            Chart.defaults.global.animation.duration = 2000; // Animation duration
            Chart.defaults.global.title.display = true;
            Chart.defaults.global.title.position = 'bottom'; // Title position
            Chart.defaults.global.defaultFontColor = '#999'; // Font color
            Chart.defaults.global.defaultFontSize = 13; // Font size for every label

            // Chart.defaults.global.tooltips.backgroundColor = '#FFF'; // Tooltips background color
            Chart.defaults.global.tooltips.borderColor = 'white'; // Tooltips border color
            Chart.defaults.global.legend.labels.padding = 0;
            Chart.defaults.scale.ticks.beginAtZero = true;
            Chart.defaults.scale.gridLines.zeroLineColor = 'rgba(255, 255, 255, 0.3)';
            Chart.defaults.scale.gridLines.color = 'rgba(255, 255, 255, 0.08)';
            Chart.defaults.global.legend.display = false;
            $.ajax({
                type: 'GET',
                url: '../../../api/product/stats/' + productId,
                success: function (data) {
                    quantityList = data.quantity;
                    invoice_no_list = data.inv_orders;
                    total_price_list = data.total_price;
                    setChart1();
                    setChart2();
                },
                error: function (error_data) {
                    console.log(error_data)
                }
            })

            function setChart1() {
                var Chart1 = document.getElementById('salesData').getContext('2d');
                var chart = new Chart(Chart1, {
                    type: 'line',
                    data: {
                        labels: invoice_no_list,
                        datasets: [{
                            label: "Month",
                            fill: false,
                            lineTension: .4,
                            startAngle: 2,
                            data: total_price_list,
                            backgroundColor: "transparent",
                            pointBorderColor: "#4bc0c0",
                            borderColor: '#4bc0c0',
                            borderWidth: 2,
                            showLine: true,
                        }]
                    },

                    // Configuration options
                    options: {
                        title: {
                            display: true,
                            text: "Last 10 Sales"
                        },
                        scales: {
                                yAxes: [{
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'Values (in Rs.)'
                                    }
                                }]
                            }
                    }
                });
            }

            function setChart2() {
                var chart2 = document.getElementById('salesData1').getContext('2d');
                var myChart = new Chart(chart2, {
                    type: 'bar',
                    data: {
                        labels: invoice_no_list,
                        datasets: [{
                            label: "Sales",
                            fill: false,
                            lineTension: 0,
                            startAngle: 2,
                            data: quantityList,
                            // , '#ff6384', '#4bc0c0', '#ffcd56', '#457ba1'
                            backgroundColor: "transparent",
                            pointBorderColor: "#ff6384",
                            borderColor: '#ff6384',
                            borderWidth: 2,
                            showLine: true,
                        }]
                    },
                    options: {
                            title: {
                                display: true,
                                text: "Last 10 Quantity of Item sold"
                            },
                            scales: {
                                yAxes: [{
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'Quantity'
                                    }
                                }]
                            }
                        }
                });
            }
        })
    </script>
{% endblock %}

